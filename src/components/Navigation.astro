---
const accessToken = Astro.cookies.get("sb-access-token")?.value;
const refreshToken = Astro.cookies.get("sb-refresh-token")?.value;
const isLoggedIn = !!accessToken && !!refreshToken;
---

<header class="border-b border-green-800/30 bg-white">
  <nav class="max-w-7xl mx-auto px-10 h-20 flex items-center justify-between">

    <!-- Links -->
    <ul class="flex items-center gap-12 list-none text-lg text-green-900">
      <li>
        <!-- Logo -->
        <a href="/" class="flex items-center">
          <img
            src="/Icon_logo.png"
            alt="Innova Green Journal"
            class="h-12 w-12 object-contain"
          />
        </a>
      </li>

      <li><a href="/about" class="no-underline hover:underline">About</a></li>
      <li><a href="/posts" class="no-underline hover:underline">Posts</a></li>

      <li>
        <a
          href="/newpost"
          class="px-4 py-2 text-lg font-medium border border-[#daffa8] text-green-800 rounded-md transition
                 hover:bg-[#daffa8] hover:text-green-900 active:bg-green-700 active:text-white hover:scale-105"
        >
          ï¼‹ Post
        </a>
      </li>
    </ul>

    <!-- Right: Search + User + Settings -->
    <div class="flex items-center gap-3 relative">

      <!-- Search -->
      <div class="relative flex items-center">
        <button
          id="search-btn"
          aria-label="Search"
          class="p-2 text-gray-500 hover:text-green-700 focus:outline-none"
          type="button"
        >
          <svg xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 24 24"
            stroke="currentColor" stroke-width="1.5"
            class="h-5 w-5">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M21 21l-4.35-4.35m1.6-5.15a7.5 7.5 0 1 1-15 0
                7.5 7.5 0 0 1 15 0Z" />
          </svg>
        </button>

        <input
          id="search-input"
          type="text"
          placeholder="Search posts..."
          class="hidden ml-2 px-3 py-1 text-sm border border-green-900/30
                 rounded focus:outline-none focus:border-green-700"
        />
      </div>

      <!-- User menu -->
      <div class="relative">
        <button
          id="menu-btn"
          aria-label="User menu"
          class="p-2 text-gray-500 hover:text-green-700 focus:outline-none"
          type="button"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="1.5"
            class="h-5 w-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.5 20.25a7.5 7.5 0 0 1 15 0"
            />
          </svg>
        </button>

        <!-- Dropdown -->
        <div
          id="menu"
          class="hidden absolute top-full right-0 mt-2 w-44 bg-white border border-green-900/20 rounded shadow-sm z-50 overflow-hidden"
        >
          {isLoggedIn ? (
            <>
              <a href="/dashboard" class="block px-4 py-2 text-sm text-green-900 hover:bg-[#DAFFA8] no-underline">
                My profile
              </a>
              <a href="/myposts" class="block px-4 py-2 text-sm text-green-900 hover:bg-[#DAFFA8] no-underline">
                My posts
              </a>
              <a href="/api/auth/signout" class="block px-4 py-2 text-sm text-green-900 hover:bg-[#DAFFA8] no-underline">
                Sign out
              </a>
            </>
          ) : (
            <>
              <a href="/signin" class="block px-4 py-2 text-sm text-green-900 hover:bg-[#DAFFA8] no-underline">
                Sign in
              </a>
              <a href="/register" class="block px-4 py-2 text-sm text-green-900 hover:bg-[#DAFFA8] no-underline">
                Register
              </a>
            </>
          )}
        </div>
      </div>

      <!-- Settings icon (visual only) -->
      <button
        aria-label="Settings"
        class="p-2 text-gray-500 hover:text-green-700 focus:outline-none"
        type="button"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5"
          class="h-5 w-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.34 3.94c.09-.54.56-.94 1.11-.94h1.1
              c.55 0 1.02.4 1.11.94l.15.9
              c.04.25.2.46.43.6l.77.45
              c.23.13.5.14.73.02l.83-.42
              c.5-.25 1.1-.05 1.37.45l.55.95
              c.27.5.1 1.13-.38 1.41l-.79.46
              c-.22.13-.36.36-.36.62v.9
              c0 .26.14.49.36.62l.79.46
              c.48.28.65.91.38 1.41l-.55.95
              c-.27.5-.87.7-1.37.45l-.83-.42
              c-.23-.12-.5-.11-.73.02l-.77.45
              c-.23.14-.39.35-.43.6l-.15.9
              c-.09.54-.56.94-1.11.94h-1.1
              c-.55 0-1.02-.4-1.11-.94l-.15-.9
              c-.04-.25-.2-.46-.43-.6l-.77-.45
              c-.23-.13-.5-.14-.73-.02l-.83.42
              c-.5.25-1.1.05-1.37-.45l-.55-.95
              c-.27-.5-.1-1.13.38-1.41l.79-.46
              c.22-.13.36-.36.36-.62v-.9
              c0-.26-.14-.49-.36-.62l-.79-.46
              c-.48-.28-.65-.91-.38-1.41l.55-.95
              c.27-.5.87-.7 1.37-.45l.83.42
              c.23.12.5.11.73-.02l.77-.45
              c.23-.14.39-.35.43-.6l.15-.9Z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
          />
        </svg>
      </button>

    </div>
  </nav>
</header>

<script>
  const btn = document.getElementById("menu-btn");
  const menu = document.getElementById("menu");

  if (btn && menu) {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      menu.classList.toggle("hidden");
    });

    document.addEventListener("click", () => {
      if (!menu.classList.contains("hidden")) {
        menu.classList.add("hidden");
      }
    });
  }
</script>

<script>
  const searchBtn = document.getElementById("search-btn");
  const searchInput = document.getElementById("search-input");

  if (searchBtn && searchInput) {
    searchBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      searchInput.classList.toggle("hidden");
      if (!searchInput.classList.contains("hidden")) searchInput.focus();
    });

    document.addEventListener("click", () => {
      if (!searchInput.classList.contains("hidden")) {
        searchInput.classList.add("hidden");
      }
    });
  }
</script>
