---
export const prerender = false;

import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";

type Post = {
  id: number;
  title: string;
  created_at: string;
};

// Traer los últimos 5 posts (más recientes primero)
// Traer últimos 5 (nuevo -> viejo)
const { data: posts, error } = await supabase
  .from("Post")
  .select("id, title, content, author_name, created_at")
  .order("created_at", { ascending: false })
  .limit(5);

const safePosts = posts ?? [];
const featured = safePosts[0];
const rest = safePosts.slice(1);

function excerpt(text?: string, max = 140) {
  if (!text) return "";
  const clean = text.replace(/\s+/g, " ").trim();
  return clean.length > max ? clean.slice(0, max).trim() + "…" : clean;
}
---

<Layout title="Home | Innova Green Journal" current="">
  <!-- HERO (tu hero actual) -->
  <section class="relative h-screen">
    <img
      src="/index_picture.png"
      alt="Innova Green Journal cover"
      class="absolute inset-0 w-full h-full object-cover shadow-sm border border-gray-200 "
    />
  </section>

  <!-- WELCOME-->
  <section class="bg-gray-50 shadow-sm border border-gray-200 ">
  <div class="max-w-4xl mx-auto px-8 py-20 text-center">

    <h1 class="text-3xl font-semibold text-green-900">
      Welcome to Innova Green Journal
    </h1>

    <p class="mt-6 text-green-900/70 leading-relaxed">
      A place to explore everything about plants, connect with people who share your passion,
      read curated news, and follow real plant journeys from our community.
    </p>

    <p class="mt-6 text-green-900/60">
      Discover stories, tips, and real journeys from our green community.
    </p>

  </div>
</section>

  <!-- LAST 5 POSTS -->
<section class="max-w-7xl mx-auto px-10 py-14">
  <div class="flex items-end justify-between">
    <h2 class="text-3xl font-semibold text-green-900">Latest posts</h2>
    
    <a href="/posts" class="text-sm text-green-900/70 hover:text-green-700 hover:underline">
      View all →
    </a>
  </div>

  {error && (
    <p class="mt-4 text-red-600">Could not load posts.</p>
  )}

  {!safePosts.length ? (
    <p class="mt-6 text-green-900/70">No posts yet.</p>
  ) : (
    <div class="mt-8 grid gap-6 lg:grid-cols-12">
      <!-- Featured (más nuevo) -->
      <article class="lg:col-span-7">
        <div class="h-full rounded-2xl border border-green-900/10 bg-gray-100 p-7 shadow-sm">
          <p class="text-xs tracking-wide text-green-900/50 uppercase">
            Latest
          </p>

          <h3 class="mt-2 text-2xl font-semibold text-green-800">
            {featured.title}
          </h3>

          <p class="mt-2 text-sm text-green-900/60">
            {featured.author_name ?? "Unknown author"} ·{" "}
            {new Date(featured.created_at).toLocaleDateString()}
          </p>

         <p class="mt-5 text-green-900/80 leading-relaxed whitespace-pre-line">
         {featured.content}
          </p>
        </div>
      </article>

      <!-- Right list -->
      <div class="lg:col-span-5 flex flex-col gap-4">
        {rest.map((p) => (
          <article class="rounded-2xl border border-green-900/10 bg-gray-100 p-5 shadow-sm">
            <h4 class="text-lg font-semibold text-green-800">
              {p.title}
            </h4>

            <p class="mt-1 text-xs text-green-900/60">
              {p.author_name ?? "Unknown author"} ·{" "}
              {new Date(p.created_at).toLocaleDateString()}
            </p>

            <p class="mt-3 text-sm text-green-900/75">
              {excerpt(p.content, 120)}
            </p>

            <div class="mt-4">
              <a
                href={`/posts/${p.id}`}
                class="inline-flex items-center text-sm font-medium text-green-800 hover:text-green-700"
              >
                View more <span class="ml-1">→</span>
              </a>
            </div>
          </article>
        ))}
      </div>
    </div>
  )}
</section>

</Layout>





